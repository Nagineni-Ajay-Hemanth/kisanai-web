<!-- login page -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kisan AI - Customer Login</title>
    <!-- Force reload css -->
    <link rel="stylesheet" href="../shared/style.css?v=2">
    <script src="../shared/api-client.js?v=3"></script>
    <script src="../shared/translations.js?v=3"></script>
    <script src="../shared/language-manager.js?v=3"></script>
</head>

<body>

    <div class="auth-container" style="position: relative;">
        <!-- Language Switcher -->
        <button onclick="window.toggleLanguageModal()" type="button"
            style="position: absolute; top: 20px; right: 20px; background: transparent; border: none; cursor: pointer; z-index: 1000;">
            <img src="../shared/assets/language.png" alt="language" style="width: 32px; height: 32px;">
        </button>


        <!-- LOGIN BOX -->
        <div class="auth-card" id="loginBox">
            <div style="text-align: center; margin-bottom: 24px;">
                <img src="../shared/assets/icon.png" alt="Kisan AI Logo"
                    style="width: 64px; height: 64px; margin-bottom: 12px;">
                <h2 style="color: var(--primary); margin-bottom: 4px;">Kisan AI</h2>
                <p style="color: var(--accent); font-weight: 600; font-size: 0.9rem; margin-bottom: 16px;">Har Kisan Ka
                    Digital Saathi</p>
                <h3 style="color: var(--text-main); margin-bottom: 8px;" data-i18n="login_title">Welcome Back</h3>
                <p style="color: var(--text-secondary);" data-i18n="login_subtitle">Login to manage your farm
                    efficiently</p>
            </div>

            <!-- Tabs -->
            <div class="tab-container">
                <button onclick="switchLoginMode('password')" id="tabPassword" class="tab-btn active"
                    data-i18n="tab_password">Password</button>
                <button onclick="switchLoginMode('otp')" id="tabOtp" class="tab-btn" data-i18n="tab_otp">OTP</button>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="label_mobile">Mobile Number</label>
                <input type="tel" id="loginMobile" class="form-input" placeholder="e.g. 9876543210"
                    data-i18n="ph_mobile" inputmode="numeric" pattern="[0-9]*">
            </div>

            <!-- Password Mode -->
            <div id="sectionPassword">
                <div class="form-group">
                    <label class="form-label" data-i18n="label_password">Password</label>
                    <div style="position: relative;">
                        <input type="password" id="loginPassword" class="form-input" placeholder="Enter password"
                            data-i18n="ph_password">
                        <span id="loginToggle" onclick="togglePassword('loginPassword', this)"
                            style="position: absolute; right: 12px; top: 14px; cursor: pointer; color: var(--text-secondary);">üëÅÔ∏è</span>
                    </div>
                </div>
                <button onclick="login()" class="btn-primary" id="btnLogin" data-i18n="btn_login">
                    Login
                </button>
            </div>

            <!-- OTP Mode -->
            <div id="sectionOtp" style="display: none;">
                <div id="otpRequestStep">
                    <button onclick="sendOtp()" class="btn-primary" id="btnGetOtp" data-i18n="btn_get_otp">
                        Get OTP Code
                    </button>
                </div>

                <div id="otpVerifyStep" style="display: none;">
                    <div class="form-group">
                        <label class="form-label" data-i18n="label_enter_otp">Enter OTP</label>
                        <input type="text" id="loginOtpInput" class="form-input" placeholder="4-digit code"
                            data-i18n="ph_otp" maxlength="4"
                            style="letter-spacing: 4px; text-align: center; font-size: 1.2rem;" inputmode="numeric"
                            pattern="[0-9]*">
                    </div>
                    <button onclick="verifyOtpAndLogin()" class="btn-primary" id="btnVerifyOtp"
                        data-i18n="btn_verify_login">
                        Verify & Login
                    </button>
                    <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary); cursor: pointer; text-decoration: underline;"
                        onclick="resetOtpFlow()" data-i18n="resend_otp">Resend OTP</p>
                </div>
            </div>

            <p id="loginError"
                style="color: #d32f2f; margin-top: 15px; text-align: center; font-size: 0.95rem; display: none; background: #ffebee; padding: 10px; border-radius: 4px;">
            </p>

            <div style="text-align: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                <span style="color: var(--text-secondary);" data-i18n="no_account">Don't have an account? </span>
                <a href="#" onclick="showRegister()" style="color: var(--primary); font-weight: 600;"
                    data-i18n="register_now">Register Now</a>
            </div>
        </div>

        <!-- REGISTER BOX (No Change needed, reusing style) -->
        <div class="auth-card" id="registerBox" style="display: none;">
            <div style="text-align: center; margin-bottom: 24px;">
                <img src="../shared/assets/icon.png" alt="Kisan AI Logo"
                    style="width: 64px; height: 64px; margin-bottom: 12px;">
                <h2 style="color: var(--primary); margin-bottom: 4px;">Kisan AI</h2>
                <p style="color: var(--accent); font-weight: 600; font-size: 0.9rem; margin-bottom: 16px;">Har Kisan Ka
                    Digital Saathi</p>
                <p style="color: var(--text-secondary);" data-i18n="register_subtitle">Join Kisan AI and start growing
                    better</p>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="label_fullname">Full Name</label>
                <input type="text" id="regName" class="form-input" placeholder="e.g. Ajay Kumar" data-i18n="ph_name">
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="label_mobile">Mobile Number</label>
                <input type="tel" id="regMobile" class="form-input" placeholder="e.g. 9876543210" data-i18n="ph_mobile">
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="label_password">Password</label>
                <div style="position: relative;">
                    <input type="password" id="regPassword" class="form-input" placeholder="Create password"
                        data-i18n="ph_create_pass">
                    <span onclick="togglePassword('regPassword', this)"
                        style="position: absolute; right: 12px; top: 14px; cursor: pointer; color: var(--text-secondary);">üëÅÔ∏è</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="label_confirm_pass">Confirm Password</label>
                <div style="position: relative;">
                    <input type="password" id="regConfirm" class="form-input" placeholder="Confirm password"
                        data-i18n="ph_confirm_pass">
                    <span onclick="togglePassword('regConfirm', this)"
                        style="position: absolute; right: 12px; top: 14px; cursor: pointer; color: var(--text-secondary);">üëÅÔ∏è</span>
                </div>
            </div>

            <button onclick="register()" class="btn-primary" id="btnRegister" data-i18n="btn_register">
                Register
            </button>
            <p id="regError"
                style="color: #d32f2f; margin-top: 15px; text-align: center; font-size: 0.95rem; display: none; background: #ffebee; padding: 10px; border-radius: 4px;">
            </p>

            <div style="text-align: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                <span style="color: var(--text-secondary);" data-i18n="have_account">Already have an account? </span>
                <a href="#" onclick="showLogin()" style="color: var(--primary); font-weight: 600;"
                    data-i18n="login_here">Login Here</a>
            </div>
        </div>

    </div>

    <!-- Language Modal (Hardcoded to ensure existence) -->
    <div id="languageModal" class="lang-modal">
        <div class="lang-modal-content">
            <span class="close-modal" onclick="window.toggleLanguageModal()">&times;</span>
            <h3 style="margin-bottom: 12px; font-size:1.2rem;">Select Language</h3>
            <div class="lang-options">
                <button onclick="window.setLanguage('en')">English</button>
                <button onclick="window.setLanguage('hi')">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</button>
                <button onclick="window.setLanguage('te')">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</button>
            </div>
        </div>
    </div>

    <!-- Fallback script for language functions -->
    <script>
        // Ensure these functions exist even if language-manager.js fails to load
        if (typeof window.toggleLanguageModal !== 'function') {
            window.toggleLanguageModal = function () {
                const modal = document.getElementById('languageModal');
                if (modal) {
                    modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
                }
            };
        }
        if (typeof window.setLanguage !== 'function') {
            window.setLanguage = function (lang) {
                console.warn(`setLanguage('${lang}') called, but language-manager.js might not be loaded.`);
                window.toggleLanguageModal(); // Close modal even if language change fails
            };
        }
    </script>

    <script src="customer-login.js?v=3"></script>
</body>

</html>